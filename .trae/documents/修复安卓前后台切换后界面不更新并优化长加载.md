## 目标
- 修复应用从后台返回前台时界面不更新的问题，兼顾长时间加载场景的用户体验与性能。
- 保证 UI 线程不被阻塞，恢复时强制触发一次可靠的界面刷新与 GL 上下文同步。

## 生命周期恢复
- 确认现有生命周期链路：
  - Java 层 `onPause()/onResume()` 驱动原生恢复/暂停：`templates/android/.../SDLActivity.java:432–455`
  - C 层在恢复时重建/恢复 EGL 上下文，并派发前台与窗口事件：`project/lib/sdl/src/video/android/SDL_androidevents.c:192–268`, `271–355`
- 修改点（确保恢复必定刷新）：
  - 在恢复 GL 上下文后，无论尺寸是否变化，都发送一次尺寸/曝光事件以触发渲染：
    - 将 `android_egl_context_restore(...)` 中仅在尺寸变化时调用的逻辑改为“无条件”执行 `Android_SendResize(window)`；参考函数位置：`SDL_androidevents.c:77–168`，`SDL_androidvideo.c:276–306`
    - 选做：同时发送 `SDL_WINDOWEVENT_EXPOSED` 以确保 Lime 层收到绘制信号（保持与 `RESTORED` 事件一致的行为）。
  - 保持/恢复垂直同步配置，避免恢复后交换缓冲被错误的 vsync 阻塞：
    - 暂停时保存：`SDL_androidevents.c:244–246`
    - 恢复时应用：`SDL_androidevents.c:156–163`

## 加载状态管理
- Java 层添加轻量加载覆盖层：
  - 在 `SDLActivity` 的 `mLayout` 上添加一个 `ProgressBar`/占位视图，并提供 `showLoading()`/`hideLoading()`；显示时禁用输入（透明遮罩）。
  - 暴露 JNI 开关方法（例如 `nativeShowLoading(boolean)`），由原生/Haxe 层控制显示与隐藏；与 `onResume()` 联动，如仍在加载则立即显示。
  - 在 `onSaveInstanceState()/onCreate()` 中保存/恢复 `isLoading` 标记，确保切换和重建时状态一致；参考插入点：`SDLActivity.java:304–366`, `430–475`。
- Haxe/Lime 层保存加载状态与进度：
  - 在 `lime.app.Application` 上维护 `LoadingStateManager`（布尔与进度值），
  - 在恢复相关事件到来时恢复 UI：
    - 渲染上下文事件：`NativeApplication.hx:388–415`
    - 窗口恢复事件：`NativeApplication.hx:608–612`

## 后台任务优化
- 使用生命周期感知的异步任务（不引入 AndroidX 依赖）：
  - 将重资源加载移到后台线程/执行器；避免在 UI 线程或 SDL 主渲染线程里阻塞。
  - 在进入后台时暂停非必要加载，前台时恢复：
    - 前后台事件由 C 层派发：后台 `SDL_APP_WILLENTERBACKGROUND/DIDENTERBACKGROUND`（`SDL_androidevents.c:247–249`），前台 `SDL_APP_WILLENTERFOREGROUND/DIDENTERFOREGROUND`（`SDL_androidevents.c:217–218`）。
    - 在 `SDLApplication.cpp`/Haxe 层监听上述事件，暂停 I/O、网络或解码任务；前台恢复并触发一次 UI 刷新。
  - Haxe 侧建议：使用 `sys.thread.Thread` 或 `lime.app.Future` 承载加载，结果通过主循环回投，避免直接在渲染周期内等待。

## 验证与回归
- 启动恢复流程日志检查：
  - 观察 `surfaceChanged()` 与 `nativeSetScreenResolution()` 调用：`SDLActivity.java:1880–1913`
  - 观察 `android_egl_context_restore()` 执行与后续 `Android_SendResize(window)`：`SDL_androidevents.c:77–168`, `SDL_androidvideo.c:276–306`
  - 确认事件派发：窗口 `RESTORED/MINIMIZED` 与 APP 前后台事件：`SDL_androidevents.c:217–220`, `247–250`
- 长加载场景手动测试：
  - 模拟耗时加载，验证 UI 覆盖层显示/隐藏与恢复后一帧必定刷新。
  - 验证后台暂停、前台恢复后不会阻塞 UI 线程，帧率与交换缓冲正常。

## 变更范围与文件
- Java：`templates/android/template/app/src/main/java/org/libsdl/app/SDLActivity.java` 与（若存在项目副本）`project/lib/sdl/android-project/app/src/main/java/org/libsdl/app/SDLActivity.java`
- C/SDL：`project/lib/sdl/src/video/android/SDL_androidevents.c`, `SDL_androidvideo.c`
- Haxe：`src/lime/_internal/backend/native/NativeApplication.hx`（事件钩子与加载状态集成）

请确认以上实施方案，确认后我将按上述文件逐步修改并提供可验证的运行结果。